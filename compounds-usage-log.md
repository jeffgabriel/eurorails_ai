# Compounds Skill Usage Log

Tracks when the compounds skill was used and what benefit it provided.

| Date | Task/Context | Benefit |
|------|-------------|---------|
| 2026-02-14 | Track usage fee bug — BFS picks shortest path through opponent track instead of own track | Identified all key files (trackUsageFees.ts, MovementExecutor.ts, UIManager.ts, PlayerStateService.ts) and the full data flow (computeTrackUsageForMove → bfsPath → confirmOpponentTrackFee popup) in a single query, enabling quick root cause identification |
| 2026-02-14 | Bot builds track randomly, never reaches demand cities | Compounds identified OptionGenerator, computeBuildSegments, identifyTargetCity, and determineStartPositions as the key components. Revealed that computeBuildSegments had no target parameter and generateBuildTrackOptions never passed demand info. Confirmed BuildTowardMajorCity action type existed but was never generated. |
| 2026-02-14 | Investigate server-side reversal enforcement | Compounds traced the full movement flow: moveTrainForUser → position update → movement_history. Found the client-side reversal logic (isReversalByDirectionFallback, isTerrainCityOrFerry) in TrainMovementManager.ts and confirmed no equivalent exists server-side. Also identified that movement_history already stores per-move segments server-side, providing the data needed for direction detection. |
| 2026-02-14 | Bot carries 3 loads on Freight train (capacity 2) | Two compounds queries mapped the full load pickup/delivery architecture: identified TurnExecutor.handlePickupLoad has no capacity check, and AIStrategyEngine pickup loop generates options once then iterates without re-checking capacity. Also confirmed deliverLoadForUser correctly removes loads. Pinpointed both root causes without manual file searching. |
| 2026-02-15 | Strategy Inspector tech spec research — 13 compounds queries | Mapped entire AI bot pipeline (WorldSnapshotService, OptionGenerator, Scorer, PlanValidator, TurnExecutor, AIStrategyEngine, BotTurnTrigger), existing debug infrastructure (DebugOverlay with backtick toggle), socket event patterns (bot:turn-start, bot:turn-complete, turn:change), UI modal patterns (Phaser rexUI modals, React Radix dialogs), audit DB table schema (bot_turn_audits), and confirmed StrategyInspectorModal does NOT exist in source. All 13 queries returned relevant components with source code. |
| 2026-02-14 | Fix bot oscillation (München↔Milan) — Scorer needs pickup awareness | Compounds identified the full data flow: WorldSnapshotService populates loadAvailability from demand destination cities, OptionGenerator generates pickup targets (gated by hasCapacity), and Scorer's calculateMoveScore only considers delivery payoff, not pickup opportunity. Confirmed field names across DemandDeckService (demand.resource) vs ResolvedDemand (demand.loadType) for cross-referencing loadAvailability. |
| 2026-02-15 | Strategy Inspector gap analysis — 7 compounds queries | Mapped all 14 derived implementation needs across server and client. Compounds confirmed: no StrategyAudit type exists, no ScoreBreakdown type, no snapshotSummary generator, infeasible options have reason strings but no structured rejection tracking, ExecutionResult exists but lacks per-step logging, bot_turn_audits stores flat action rows (not rich audit JSON), bot:turn-complete emits basic BotTurnResult (no scoring data). Client-side: StrategyInspectorModal was built in prior branch (compounds/204) but deleted; DebugOverlay with backtick toggle exists as integration point. |
| 2026-02-15 | DropLoad implementation — 3 compounds queries | Investigated AI bot pickup/delivery pipeline, LoadService drop/return methods, and AIStrategyEngine executeLoadActions orchestration. Compounds confirmed setLoadInCity/returnLoad/isLoadAvailableAtCity patterns in server LoadService, identified the full Phase 0/1.5 load action flow, and mapped OptionGenerator demand-matching logic for reachability checks. |
| 2026-02-15 | Debug bot stuck at money=0 — 2 compounds queries | Investigated WorldSnapshotService loadAvailability population. Compounds immediately showed `getAvailableLoadsForCity` is called for `citiesOfInterest` (demand destinations + source cities), confirming load data was correct and the hard reachability gate in OptionGenerator was the root cause. |
| 2026-02-16 | PRD gap analysis — 18 compounds search queries | Systematic search across all 8 known issues: multi-delivery sequencing, scoring constants, drop load logic, state continuity, build oscillation, upgrade timing, discard hand scoring, victory tracking. Also searched for test infrastructure, bot-vs-bot loop, BotConfig, and load service. Compounds mapped the full component graph for each issue area, identifying what exists (AIStrategyEngine phases, Scorer constants, OptionGenerator chains, VictoryService BFS) and what's missing (no bot-side victory check, no state persistence between turns, no automated test harness, hard-coded discard score). |

## 2026-02-14 — Strategy Inspector Tech Spec Research

### Commands Run (11 total)
1. `compounds summary` — project overview: languages, frameworks, entity counts
2. `compounds dependencies --scope external` — 77 external packages mapped
3. `compounds search "debug overlay bot turn" --show-code` — found DebugOverlay class, renderBotTurnSection, socket event handlers
4. `compounds search "StrategyAudit bot turn audit" --show-code` — found BotTurnResult interface, takeTurn orchestration, audit INSERT patterns
5. `compounds search "bot turn complete socket event" --show-code` — found emitTurnChange, bot:turn-start/complete events, BotTurnTrigger flow
6. `compounds search "OptionGenerator feasible infeasible options" --show-code` — found generate(), makeFeasible/makeInfeasible, all option generation methods
7. `compounds search "Scorer scoring dimensions weights" --show-code` — found score(), calculateBuildTrackScore, calculateMoveScore, scoring constants
8. `compounds search "TurnExecutor execution results" --show-code` — found ExecutionResult interface, execute() dispatch, audit INSERT pattern
9. `compounds search "AIStrategyEngine strategy pipeline" --show-code` — found takeTurn 4-phase pipeline, retry logic, PassTurn fallback
10. `compounds search "modal overlay React Phaser UI component" --show-code` — found Phaser modal pattern (rexUI sizers), Radix AlertDialog, DOM overlay
11. `compounds search "WorldSnapshotService snapshot summary" --show-code` — found capture(), WorldSnapshot interface, parseSegments()

### Benefit
Comprehensive cross-module architectural mapping for tech spec. Compounds provided dependency graphs, code flow analysis, and semantic search across 3700+ entities that would have required dozens of manual grep/file-read operations. The AI-generated summaries for each query correctly identified component relationships and data flow patterns.
